<div class="container mx-auto px-4 pt-8 max-w-8xl">
    <div class="text-center mb-2">
        <h1 class="text-white text-5xl pb-4 font-bold mb-2">Book Tracker</h1>
        <p class="text-white text-lg opacity-80 pb-3">Seguimiento de tus lecturas y colección personal</p>
    </div>
    <div class="flex flex-col gap-2">
        <div class="rounded-lg p-3 bg-zinc-700 border-1 border-zinc-600 shadow-xs shadow-zinc-500 col-span-2 flex flex-col min-h-140 justify-between">
            <div class="flex flex-col gap-4 h-full">
                <p class="text-white text-2xl font-medium text-center py-4">Asistente de lectura</p>
            </div>
            <div class="flex flex-row items-center gap-1 shadow-xl/30 w-full rounded-xl bg-zinc-800 p-3 outline-1 outline-zinc-800 text-white mb-4 focus-within:ring-2 focus-within:ring-amber-400 hover:outline-amber-400 transition-all ease-out">
                <input class="bg-transparent focus:outline-none w-full placeholder-white/70" placeholder="Pregunta lo que quieras" type="text">
                <button class="bg-gradient-to-r from-amber-600 to-amber-400 text-white rounded-3xl p-2 cursor-pointer hover:contrast-125 transition-all ease-in-out">Enviar</button>
            </div>
        </div>
        <div class="flex flex-col justify-between rounded-lg p-3 bg-zinc-700 border-1 border-zinc-600 shadow-xs shadow-zinc-500 col-span-2 gap-4">
            <div class="py-4 flex flex-row items-center justify-between">
                <div class="flex flex-row items-center">
                    <img class="w-14 h-14" src="star.svg" alt="">
                    <p class="text-white text-2xl font-medium">Mis libros guardados</p>
                </div>
                <div>
                    <button (click)="openNewBookModal()" class="text-3xl text-white hover:text-amber-400 hover:scale-110 transition-all rounded-full cursor-pointer mr-4">+</button>
                    <app-add-book-modal #addBookModal (closeModal)="closeNewBookModal()" (addBook)="setBookList($event)"></app-add-book-modal>
                </div>
            </div>
            <div class="flex flex-row gap-5 items-center justify-evenly w-full flex-wrap">
                @if (books.length) {
                    @for (book of books; track $index) {
                        <section>
                            <div (click)="openBookModal(book)" class="bg-amber-600 border-1 border-amber-500 p-2 cursor-pointer rounded-lg mb-4 hover:shadow-xl/30 hover:-translate-y-3 ease-in transition">
                                <img class="rounded-2xl w-60 h-90" [src]="book.thumbnail_url" alt="Titulo del libro">
                                <p class="text-white text-xl text-center line-clamp-1">{{ book.title }}</p>
                            </div>
                            <div class="flex flex-col gap-1.5 bg-zinc-900 p-2 rounded-lg">
                                <p class="text-white text-sm">Autor: {{ book.authors[0] }}</p>
                                <p class="text-white text-sm">Total de paginas: {{ book.num_pages }}</p>
                                <p class="text-white text-sm">Genero: {{ book.categories?.join(', ') }}</p>
                                <p class="text-white text-sm">Estatus: {{ book.status }}</p>
                            </div>
                        </section>
                    }
                } @else {
                    <p class="text-center text-white text-3xl opacity-70">No tienes libros agregados! Agrega cualquier libro que quieras y visualizalo aqui</p>
                }
            </div>
            <app-book-modal #bookModal (closeModal)="closeBookModal()"></app-book-modal>
            <button (click)="setSection('book list')" class="w-full mt-6 py-3 bg-amber-500 hover:bg-amber-600 text-white rounded-lg transition duration-300 cursor-pointer">
                Ver todos los libros guardados
            </button>
        </div>
        <div class="rounded-lg p-3 bg-zinc-700 border-1 border-zinc-600 shadow-xs shadow-zinc-500 col-span-2 h-full">
            <div class="flex lg:flex-row lg:items-center lg:justify-between">
                <div class="py-4 flex flex-row items-center">
                    <img class="w-14 h-14" src="bookmarked.svg" alt="">
                    <p class="text-white text-2xl font-medium">Mis libros en seguimiento</p>
                </div>
                <div class="py-4 flex flex-wrap gap-2">
                    <button (click)="switchBookStatus('Sin leer')" [class]="bookStatus === 'Sin leer' ? activeToggleClass : inactiveToggleClass">Sin leer</button>
                    <button (click)="switchBookStatus('En progreso')" [class]="bookStatus === 'En progreso' ? activeToggleClass : inactiveToggleClass">En progreso</button>
                    <button (click)="switchBookStatus('Leidos')" [class]="bookStatus === 'Leidos' ? activeToggleClass : inactiveToggleClass">Leidos</button>
                </div>
            </div>
            @if(bookStatus === "Sin leer"){
                @if(unreadBooks.length){
                    @for (book of unreadBooks; track $index) {
                        <div class="rounded-xl p-4 bg-zinc-800 transition-all duration-300 hover:shadow-md hover:-translate-y-1 mb-5">
                            <div class="flex items-center">
                                <div class="w-16 h-20 rounded-md flex items-center justify-center text-white text-xl font-bold">
                                    <img [src]="book.thumbnail_url" alt="">
                                </div>
                                <div class="ml-4 flex-1">
                                    <h3 class="font-bold text-white">{{ book.title }}</h3>
                                    <p class="text-sm text-white">Autor: {{ book.authors[0] }}</p>
                                    <p class="text-sm text-white">Páginas: {{ book.num_pages }}</p>
                                    <p class="text-sm text-white">Pagina actual: {{ book.actual_page }}</p>
                                    <div class="flex justify-between items-center mt-2">
                                        <span class="text-xs bg-gray-200 text-gray-800 px-2 py-1 rounded-full">{{ book.status }}</span>
                                        <span class="text-xs text-gray-500">{{ (book.actual_page / book.num_pages) * 100 }}%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                        <div class="bg-gradient-to-r from-0% from-amber-700 to-50% to-amber-400 h-2 rounded-full" [style.width.%]="(book.actual_page / book.num_pages) * 100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                } @else {
                    <p class="text-center text-white text-3xl opacity-70 p-4">No tienes ningun libro sin leer, sigue asi!</p>
                }
            } @else if (bookStatus === "En progreso") {
                @if (inProgressBooks.length){
                    @for (book of inProgressBooks; track $index) {
                        <div class="rounded-xl p-4 bg-zinc-800 transition-all duration-300 hover:shadow-md hover:-translate-y-1 mb-5">
                            <div class="flex items-center">
                                <div class="w-16 h-20 rounded-md flex items-center justify-center text-white text-xl font-bold">
                                    <img [src]="book.thumbnail_url" alt="">
                                </div>
                                <div class="ml-4 flex-1">
                                    <h3 class="font-bold text-white">{{ book.title }}</h3>
                                    <p class="text-sm text-white">Autor: {{ book.authors[0] }}</p>
                                    <p class="text-sm text-white">Páginas: {{ book.num_pages }}</p>
                                    <p class="text-sm text-white">Pagina actual: {{ book.actual_page }}</p>
                                    <div class="flex justify-between items-center mt-2">
                                        <span class="text-xs bg-amber-200 text-amber-800 px-2 py-1 rounded-full">{{ book.status }}</span>
                                        <span class="text-xs text-gray-500">{{ (book.actual_page / book.num_pages) * 100 }}%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                        <div class="bg-gradient-to-r from-0% from-amber-700 to-50% to-amber-400 h-2 rounded-full" [style.width.%]="(book.actual_page / book.num_pages) * 100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                } @else{
                    <p class="text-center text-white text-3xl opacity-70 p-4">Aun no tienes ningun libro en progreso hasta el momento!</p>
                }
            } @else if (bookStatus === "Leidos") {
                @if (readBooks.length) {
                    @for (book of readBooks; track $index) {
                        <div class="rounded-xl p-4 bg-zinc-800 transition-all duration-300 hover:shadow-md hover:-translate-y-1 mb-5">
                            <div class="flex items-center">
                                <div class="w-16 h-20 rounded-md flex items-center justify-center text-white text-xl font-bold">
                                    <img [src]="book.thumbnail_url" alt="">
                                </div>
                                <div class="ml-4 flex-1">
                                    <h3 class="font-bold text-white">{{ book.title }}</h3>
                                    <p class="text-sm text-white">Autor: {{ book.authors[0] }}</p>
                                    <p class="text-sm text-white">Páginas: {{ book.num_pages }}</p>
                                    <p class="text-sm text-white">Pagina actual: {{ book.actual_page }}</p>
                                    <div class="flex justify-between items-center mt-2">
                                        <span class="text-xs bg-green-200 text-green-700 px-2 py-1 rounded-full">{{ book.status }}</span>
                                        <span class="text-xs text-gray-500">{{ (this.readBooks[0].actual_page / this.readBooks[0].num_pages) * 100 }}%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                                        <div class="bg-gradient-to-r from-0% from-amber-700 to-50% to-amber-400 h-2 rounded-full" [style.width.%]="(book.actual_page / book.num_pages) * 100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                } @else{
                    <p class="text-center text-white text-3xl opacity-70 p-4">Aun no tienes ningun libro leido hasta el momento!</p>
                }
            }
            <div class="mt-2 text-center">
                <button (click)="openBookStatusModal()" class="px-6 py-3 bg-amber-500 hover:bg-amber-600 text-white rounded-lg shadow transition duration-300 flex items-center justify-center mx-auto cursor-pointer">
                    <p class="text-2xl font-bold mr-4">+</p><p>Agregar libro</p> 
                </button>
            </div>
            <app-add-book-status-modal #bookStatusModal (addBook)="handleNewBook($event)" [books]="books" (closeModal)="closeBookStatusModal()">
            </app-add-book-status-modal>
        </div>
        <div class="grid grid-cols-2 gap-2">
            <div class="rounded-lg p-3 bg-zinc-700 border-1 border-zinc-600 shadow-xs shadow-zinc-500">
                <div class="flex flex-col gap-4 h-full justify-between">
                    <div class="flex flex-row justify-between items-center">
                        <p class="text-white text-2xl font-medium">Mis citas favoritas</p>
                        <button (click)="openAddQuoteModal()" class="text-3xl text-white hover:text-amber-400 hover:scale-110 transition-all rounded-full cursor-pointer mr-4">+</button>
                    </div>
                    <div class="flex flex-col gap-2">
                        @for (quote of quotes; track $index) {
                            <div class="bg-zinc-800 p-4 rounded-lg border-l-4 border-amber-600 shadow-sm">
                                <p class="text-white italic">"{{ quote.content }}"</p>
                                <div class="mt-2 flex items-center">
                                    <div class="w-8 h-8 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-md flex items-center justify-center text-white text-xs">A</div>
                                    <div class="ml-3">
                                        <p class="text-sm font-medium text-white opacity-80">{{ quote.books.title }}</p>
                                        <p class="text-xs text-white opacity-70">{{ quote.books.authors.join(', ')}}</p>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    <button (click)="setSection('book quotes')" class="w-full mt-6 py-2 cursor-pointer bg-amber-500 hover:bg-amber-600 text-gray-700 rounded-lg transition duration-300">
                            Ver todas las citas
                    </button>
                </div>
            </div>
            <div class="rounded-lg p-3 bg-zinc-700 border-1 border-zinc-600 shadow-xs shadow-zinc-500">
                <div class="flex flex-col h-full justify-between gap-4">
                    <div class="flex flex-row justify-between">
                        <p class="text-white text-2xl font-medium">Mis bibliotecas</p>
                        <button (click)="openAddLibraryModal()" class="text-3xl text-white hover:text-amber-400 hover:scale-110 transition-all rounded-full cursor-pointer mr-4">+</button>
                    </div>
                    <div class="flex flex-col gap-2">
                        @if (libraries.length) {
                            @for (library of libraries; track $index) {
                                <div class="p-4 rounded-lg flex items-center hover:bg-zinc-800 transition-all">
                                    <div [style.background-color]="library.library_color" class="w-10 h-10 text-white rounded-lg flex items-center justify-center">{{ library.abreviation }}</div>
                                    <div class="ml-4 flex-1">
                                        <h3 class="font-medium text-white">{{ library.name }}</h3>
                                        <p class="text-sm text-white opacity-80">{{ library.book_count }} libros en esta libreria</p>
                                    </div>
                                </div>
                            }
                        } @else {
                            <p class="text-center text-white text-3xl opacity-70 p-4">Aun no tienes ninguna biblioteca creada, crea una y agrega libros a ella!</p>
                        }
                    </div>
                    <button (click)="setSection('book libraries')" class="w-full mt-6 py-2 cursor-pointer bg-amber-500 hover:bg-amber-600 text-gray-700 rounded-lg transition duration-300">
                        Gestionar bibliotecas
                    </button>
                </div>
            </div>
            <app-add-quote-modal #addQuoteModal (createdQuote)="addQuote($event)"></app-add-quote-modal>
            <app-add-library-modal #addLibraryModal (createdLibrary)="addLibrary($event)" (closeModal)="closeAddLibraryModal()"></app-add-library-modal>      
        </div>
    </div>
</div>